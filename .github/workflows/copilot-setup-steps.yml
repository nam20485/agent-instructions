name: "Copilot Setup Steps - Using Devcontainer Prebuild"

on:
  workflow_dispatch:

jobs:
  copilot-setup-steps:
    runs-on: ubuntu-22.04
    permissions:
      contents: read
      actions: read
      packages: read
    env:
      TF_PLUGIN_CACHE_DIR: ~/.terraform.d/plugin-cache
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      # Caching intentionally disabled for now
      # - name: Cache pip
      #   uses: actions/cache@v4
      #   with:
      #     path: ~/.cache/pip
      #     key: pip-${{ runner.os }}-${{ hashFiles('**/requirements.txt', '**/pyproject.toml') }}
      #     restore-keys: |
      #       pip-${{ runner.os }}-
      # - name: Setup Node with npm cache
      #   uses: actions/setup-node@v4
      #   with:
      #     node-version: '22'
      #     cache: 'npm'
      # - name: Cache pnpm store
      #   uses: actions/cache@v4
      #   with:
      #     path: ~/.local/share/pnpm/store
      #     key: pnpm-store-${{ runner.os }}-${{ hashFiles('**/pnpm-lock.yaml') }}
      #     restore-keys: |
      #       pnpm-store-${{ runner.os }}-
      # - name: Cache NuGet packages
      #   uses: actions/cache@v4
      #   with:
      #     path: ~/.nuget/packages
      #     key: nuget-${{ runner.os }}-${{ hashFiles('**/*.csproj', '**/*.fsproj', '**/packages.lock.json') }}
      #     restore-keys: |
      #       nuget-${{ runner.os }}-
      # - name: Cache Terraform plugins
      #   uses: actions/cache@v4
      #   with:
      #     path: ~/.terraform.d/plugin-cache
      #     key: terraform-${{ runner.os }}
      #     restore-keys: |
      #       terraform-${{ runner.os }}

      - name: Provision environment (single Linux script)
        shell: bash
        run: |
          chmod +x scripts/linux-dockerfile-converted-setup.sh
          scripts/linux-dockerfile-converted-setup.sh

     
